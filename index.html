<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>otl-compare-school-districts</title>
    <script src='https://api.mapbox.com/mapbox.js/v2.2.1/mapbox.js'></script>
    <link href='https://api.mapbox.com/mapbox.js/v2.2.1/mapbox.css' rel='stylesheet' />
    <!-- MapBox API public token
pk.eyJ1IjoiamFja2RvdWdoZXJ0eSIsImEiOiJxMi11TGlzIn0.ydUTGpMKcADi7fKPxy0GVA -->

    <style type="text/css">
        html, body { width: 100%; height: 100%; margin: 0; }
        #map1, #map2 { width: 49.5%; height: 100%; }
        #map1 { float: left; }
        #map2 { float: right; }
    </style>
</head>

<body>
    <div id="map1"></div>
    <div id="map2"></div>

    <script type="text/javascript">
    L.mapbox.accessToken = 'pk.eyJ1IjoiamFja2RvdWdoZXJ0eSIsImEiOiJxMi11TGlzIn0.ydUTGpMKcADi7fKPxy0GVA';

    //EdBuild's Chloropleth layer: two instances
    var distMap1 = L.mapbox.tileLayer('edbuild.95702fa3',{
      attribution: '&copy; <a href="http://www.edbuild.org">EdBuild, 2015; US Census, 2013.</a>'
    });
    var distMap2 = L.mapbox.tileLayer('edbuild.95702fa3',{
      attribution: '&copy; <a href="http://www.edbuild.org">EdBuild, 2015; US Census, 2013.</a>'
    });

    var startZoom = 10;


    // Testing Mapbox geocoder code variations
    // https://www.mapbox.com/mapbox.js/example/v1.0.0/map-center-geocoding/
    // https://www.mapbox.com/mapbox.js/example/v1.0.0/geocoder-keep-open/
    var map1 = L.map('map1', {
      layers: [distMap1],
      center: [41.76, -72.67], // Hartford
      zoom: startZoom,
      zoomControl: false, // add it below
      touchZoom: false, // requires manual zoom control for all below
      scrollWheelZoom: false,
      doubleClickZoom: false,
      boxZoom: false
    })
    .addControl(L.mapbox.geocoderControl('mapbox.places', {
          keepOpen: true
    }));

    new L.Control.Zoom({ position: 'topright'}).addTo(map1); // produces 1 zoom level for both maps

    var map2 = L.map('map2', {
        layers: [distMap2],
        center: [35.22, -80.84], // Charlotte NC
        zoom: startZoom,
        zoomControl: false,   // none for this side
        touchZoom: false, // requires manual zoom control for all below
        scrollWheelZoom: false,
        doubleClickZoom: false,
        boxZoom: false
    });

    //State Borders Base Layer
    L.mapbox.tileLayer('edbuild.5e7c9cb7').addTo(map1);
    L.mapbox.tileLayer('edbuild.5e7c9cb7').addTo(map2);

    //Tooltip Base Layer - Invisible
    L.mapbox.tileLayer('edbuild.b6476278').addTo(map1);
    L.mapbox.tileLayer('edbuild.b6476278').addTo(map2);
    var muniGrid = L.mapbox.gridLayer('edbuild.b6476278').addTo(map1);
    // ** TO DO ** fix duplication of content in 2nd muniGrid
    // var muniGrid2 = L.mapbox.gridLayer('edbuild.b6476278').addTo(map2);
    var muniControl = L.mapbox.gridControl(muniGrid, {follow: false}).addTo(map1);
    // var muniControl2 = L.mapbox.gridControl(muniGrid, {follow: false}).addTo(map2);

    //Streetmap Overlay Base Layer
    L.mapbox.tileLayer('edbuild.f4de156e').addTo(map1);
    L.mapbox.tileLayer('edbuild.f4de156e').addTo(map2);


//     geocoder.query('Chicago, IL', showMap);
//
// function showMap(err, data) {
//     // The geocoder can return an area, like a city, or a
//     // point, like an address. Here we handle both cases,
//     // by fitting the map bounds to an area or zooming to a point.
//     if (data.lbounds) {
//         map1.fitBounds(data.lbounds);
//     } else if (data.latlng) {
//         map1.setView([data.latlng[0], data.latlng[1]], 13);
//     }
// }


	// customize source link to your GitHub repo on map1, blank prefix on map 2
  map1.attributionControl.setPrefix('View  <a href="http://github.com/jackdougherty/otl-compare school-districts">code on GitHub</a>, created with');
  map2.attributionControl.setPrefix(''); //blank
  // add scales to both maps
  L.control.scale().addTo(map1);
  L.control.scale().addTo(map2);

  // looking for ways to optimize this simple function
  map1.on('zoomend', function(e) {
    zoomEnd = map1.getZoom(),
    map2.setZoom(zoomEnd);
  });

  // alternative method using zoomstart?
  // map1.on('zoomstart', function(e) {
  //   zoomEnd = map1.getZoom(),
  //   map2.setZoom(zoomStart);
  // });

    </script>
</body>
</html>
